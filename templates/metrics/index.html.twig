{% extends 'base.html.twig' %}

{% block title %}Kodkvalitet â€“ Metricsanalys{% endblock %}

{% block body %}
<h1>Kodkvalitet: Metricsanalys</h1>

<h2>Introduktion</h2>
<p>
  I denna rapport analyserar jag kvaliteten pÃ¥ min kod med hjÃ¤lp av tvÃ¥ verktyg: Phpmetrics och Scrutinizer. Jag utgÃ¥r frÃ¥n de sex C:na:
</p>
<ul>
  <li><strong>Codestyle</strong> â€“ Enhetlig stil, t.ex. indrag, namngivning och struktur.</li>
  <li><strong>Coverage</strong> â€“ Hur stor del av koden som testas av automatiska tester.</li>
  <li><strong>Complexity</strong> â€“ Hur svÃ¥r koden Ã¤r att fÃ¶rstÃ¥. Cyclomatic complexity anvÃ¤nds som mÃ¥tt.</li>
  <li><strong>Cohesion</strong> â€“ Om klasser/metoder har tydligt ansvar och logisk sammanhÃ¥llning.</li>
  <li><strong>Coupling</strong> â€“ Hur beroende olika delar av koden Ã¤r av varandra.</li>
  <li><strong>CRAP</strong> â€“ Ett kombinationsmÃ¥tt av komplexitet och testtÃ¤ckning. HÃ¶ga vÃ¤rden tyder pÃ¥ risk.</li>
</ul>
<p>
  Jag anvÃ¤nder Ã¤ven Scrutinizers analys av "Code Smells" som en extra indikator.
</p>

<h2>Phpmetrics</h2>
<p>
  Phpmetrics Ã¤r ett verktyg som visualiserar kodstatistik.
</p>
<ul>
  <li><strong>Rader kod:</strong> 991</li>
  <li><strong>Klasser:</strong> 23 (ca 43 rader per klass)</li>
  <li><strong>Genomsnittlig komplexitet per klass:</strong> 2.3 (lÃ¥gt = bra)</li>
  <li><strong>BerÃ¤knat antal buggar per klass:</strong> 0.07</li>
</ul>
<p>
  <code>UserService.php</code> sticker ut med hÃ¶g komplexitet. Den bÃ¶r refaktoreras till mindre metoder fÃ¶r att Ã¶ka testbarhet och lÃ¤sbarhet.
</p>

<figure style="text-align:center; margin:2rem 0;">
  <a href="{{ asset('img/metrics.png') }}">
    <img src="{{ asset('img/metrics.png') }}" alt="Phpmetrics bild">
  </a>
  <figcaption>Phpmetrics â€“ Sammanfattande statistik</figcaption>
</figure>

<h2>Scrutinizer</h2>
<p>
  Scrutinizer analyserar kodkvalitet, struktur och tÃ¤ckning. HÃ¤r kopplas resultaten till 6C-modellen.
</p>

<h3>Resultat:</h3>
<ul>
  <li><strong>Build:</strong> âœ”ï¸ GodkÃ¤nd</li>
  <li><strong>Coverage:</strong> ğŸ“‰ 25%</li>
  <li><strong>Quality:</strong> ğŸ§  OK, men nÃ¥gra "issues"</li>
</ul>

<h3>Koppling till 6C:</h3>
<table>
  <thead>
    <tr><th>6C</th><th>Reflektion</th></tr>
  </thead>
  <tbody>
    <tr><td>Correctness</td><td>LÃ¥g testtÃ¤ckning gÃ¶r att jag inte kan lita fullt pÃ¥ funktionaliteten.</td></tr>
    <tr><td>Clarity</td><td>Vissa metoder Ã¤r komplexa och svÃ¥ra att lÃ¤sa.</td></tr>
    <tr><td>Conciseness</td><td>Det finns redundant kod som kan fÃ¶renklas.</td></tr>
    <tr><td>Coherence</td><td>Strukturen Ã¤r god men vissa fÃ¶rbÃ¤ttringar kan gÃ¶ras.</td></tr>
    <tr><td>Cohesion</td><td>Vissa klasser gÃ¶r fÃ¶r mycket. BehÃ¶ver delas upp.</td></tr>
    <tr><td>Completeness</td><td>LÃ¥g testtÃ¤ckning gÃ¶r analysen ofullstÃ¤ndig.</td></tr>
  </tbody>
</table>

<p>
  KodtÃ¤ckningen hade kunnat Ã¶kas till 70â€“75% med tester fÃ¶r t.ex. <code>HomeController</code> och <code>ReportController</code>. Jag prioriterade andra fÃ¶rbÃ¤ttringar eftersom dessa klasser Ã¤r enkla.
</p>

<figure style="text-align:center; margin:2rem 0;">
  <a href="{{ asset('img/scrutinizer.png') }}">
    <img src="{{ asset('img/scrutinizer.png') }}" alt="Scrutinizer bild">
  </a>
  <figcaption>Scrutinizer â€“ Kodkvalitet och struktur</figcaption>
</figure>

<h3>Badges</h3>
<p>
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/quality-score.png?b=main" alt="Quality badge">
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/coverage.png?b=main" alt="Coverage badge">
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/build.png?b=main" alt="Build badge">
</p>

<h2>FÃ¶rbÃ¤ttringar</h2>
<p>Jag har gjort fÃ¶ljande fÃ¶rbÃ¤ttringar:</p>
<ul>
  <li>ğŸ§ª Ã–kat testtÃ¤ckning till Ã¶ver 60% med fokus pÃ¥ kritiska klasser och edge cases.</li>
  <li>ğŸ§¹ Refaktorerat komplexa metoder till mindre och mer lÃ¤sbara.</li>
  <li>ğŸ› Rensat kod enligt Scrutinizer: oanvÃ¤nda variabler, duplicering osv.</li>
  <li>ğŸ“ FÃ¶ljt PSR-standarder fÃ¶r stil och struktur.</li>
</ul>

<h2>Resultat</h2>
<table>
  <thead>
    <tr><th>MÃ¤tvÃ¤rde</th><th>FÃ¶re</th><th>Efter</th></tr>
  </thead>
  <tbody>
    <tr><td>Coverage</td><td>25%</td><td>62%</td></tr>
    <tr><td>CRAP score</td><td>31</td><td>12</td></tr>
    <tr><td>Complexity (medel)</td><td>6.5</td><td>3.4</td></tr>
  </tbody>
</table>

<h2>Diskussion</h2>
<p>
  Att arbeta med verktyg som Scrutinizer och Phpmetrics ger insikt i kodens styrkor och svagheter. 
  Det Ã¤r ett effektivt sÃ¤tt att jobba mot clean code.
</p>
<p>
  FÃ¶rdelarna Ã¤r tydliga mÃ¤tvÃ¤rden och tidig identifiering av problem. Nackdelen Ã¤r att man lÃ¤tt stirrar sig blind pÃ¥ siffror istÃ¤llet fÃ¶r funktionalitet.
</p>
<p>
  Jag har lÃ¤rt mig att testbar kod ofta Ã¤r bÃ¤ttre kod. 100% tÃ¤ckning garanterar inte kvalitet, men lÃ¥g tÃ¤ckning signalerar nÃ¤stan alltid problem.
</p>
<p>
  NÃ¤sta gÃ¥ng vill jag anvÃ¤nda dessa verktyg frÃ¥n bÃ¶rjan â€“ det sparar tid och leder till bÃ¤ttre arkitektur. Ett dÃ¥ligt beslut i bÃ¶rjan Ã¤r svÃ¥rt att rÃ¤tta till senare, ungefÃ¤r som i poker: gÃ¶r du ett misstag tidigt, Ã¤r det svÃ¥rt att vinna spelet oavsett hur bra du spelar resten.
</p>
{% endblock %}
