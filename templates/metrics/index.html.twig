{% extends 'base.html.twig' %}

{% block title %}Kodkvalitet â€“ Metricsanalys{% endblock %}

{% block body %}
<h1>Kodkvalitet: Metricsanalys</h1>

<h2>Introduktion</h2>
<p>
I denna rapport analyserar jag kvaliteten pÃ¥ min kod med hjÃ¤lp av tvÃ¥ verktyg: Phpmetrics och Scrutinizer. Jag utgÃ¥r frÃ¥n de sex C:na:
</p>
<ul>
  <li><strong>Codestyle</strong> â€“ Att skriva kod med en enhetlig stil, t.ex. indrag, namngivning och struktur.</li>
  <li><strong>Coverage</strong> â€“ Hur stor del av koden som testas av automatiska tester.</li>
  <li><strong>Complexity</strong> â€“ Hur krÃ¥nglig och svÃ¥r koden Ã¤r att fÃ¶rstÃ¥. MÃ¤tvÃ¤rdet cyclomatic complexity visar detta.</li>
  <li><strong>Cohesion</strong> â€“ Om klasser/metoder har ett tydligt ansvar och hÃ¥ller ihop logiskt.</li>
  <li><strong>Coupling</strong> â€“ Hur beroende olika delar av koden Ã¤r av varandra.</li>
  <li><strong>CRAP</strong> â€“ Ett kombinationsvÃ¤rde av komplexitet och tÃ¤ckning, dÃ¤r hÃ¶ga vÃ¤rden visar risk.</li>
</ul>
<p>
Jag anvÃ¤nder ocksÃ¥ Scrutinizers analys av "Code Smells" som en extra indikator.
</p>

<h2>Phpmetrics</h2>
<p>
Phpmetrics Ã¤r ett verktyg som visar olika statistik om min kod.
</p>
<ul>
  <li><strong>Antal rader kod:</strong> 991</li>
  <li><strong>Antal klasser:</strong> 23 (ungefÃ¤r 43 rader per klass)</li>
  <li><strong>Genomsnittlig komplexitet per klass:</strong> 2.3 (lÃ¥gt och bra)</li>
  <li><strong>BerÃ¤knat antal buggar per klass:</strong> 0.07</li>
</ul>

<p>
En fil som sticker ut Ã¤r <code>UserService.php</code> som har hÃ¶gre komplexitet Ã¤n Ã¶vriga filer. Detta innebÃ¤r att metoderna Ã¤r lite fÃ¶r lÃ¥nga eller gÃ¶r fÃ¶r mycket. Den bÃ¶r delas upp fÃ¶r att bli lÃ¤ttare att fÃ¶rstÃ¥ och testa.
</p>

<!-- LÃ¤gg in Phpmetrics-bilden hÃ¤r -->
<div style="text-align:center; margin:2rem 0;">
  <img src="/assets/img/metrics.png" alt="Phpmetrics analys" style="max-width:100%; height:auto; border:1px solid #ccc; padding:0.5rem;">
  <figcaption>Phpmetrics - Sammanfattande statistik</figcaption>
</div>

<h2>Scrutinizer</h2>
<p>
Scrutinizer analyserar kodkvalitet, kodtÃ¤ckning och struktur. Jag kopplar det till 6C-modellen.
</p>

<h3>Resultat:</h3>
<ul>
  <li><strong>Build:</strong> âœ”ï¸ GodkÃ¤nd</li>
  <li><strong>Coverage:</strong> ğŸ“‰ 25%</li>
  <li><strong>Quality:</strong> ğŸ§  OK, men nÃ¥gra "issues"</li>
</ul>

<h3>Koppling till 6C:</h3>
<table>
  <thead>
    <tr><th>6C</th><th>Reflektion</th></tr>
  </thead>
  <tbody>
    <tr><td>Correctness</td><td>LÃ¥g testtÃ¤ckning gÃ¶r att jag inte kan vara helt sÃ¤ker pÃ¥ att allt fungerar korrekt.</td></tr>
    <tr><td>Clarity</td><td>Vissa metoder Ã¤r fÃ¶r komplexa, vilket gÃ¶r dem svÃ¥ra att lÃ¤sa.</td></tr>
    <tr><td>Conciseness</td><td>Det finns kod som kan gÃ¶ras kortare och tydligare.</td></tr>
    <tr><td>Coherence</td><td>Strukturen pÃ¥ vissa delar av projektet Ã¤r bra, men kan fÃ¶rbÃ¤ttras.</td></tr>
    <tr><td>Cohesion</td><td>NÃ¥gra klasser har fÃ¶r mycket ansvar. BÃ¶r delas upp.</td></tr>
    <tr><td>Completeness</td><td>TesttÃ¤ckningen Ã¤r lÃ¥g, sÃ¥ jag vet inte om allt fungerar som det ska.</td></tr>
  </tbody>
</table>

<p>
Jag hade kunnat Ã¶ka kodtÃ¤ckningen till 70â€“75% genom att lÃ¤gga till tester till exempelvis <code>HomeController</code> och <code>ReportController</code>. Men eftersom de Ã¤r sÃ¥ enkla valde jag att inte lÃ¤gga tid pÃ¥ det â€“ det hade inte fÃ¶rbÃ¤ttrat kodkvaliteten pÃ¥ riktigt.
</p>

<!-- LÃ¤gg in Scrutinizer-bilden hÃ¤r -->
<div style="text-align:center; margin:2rem 0;">
  <img src="/assets/img/scrutinizer.png" alt="Scrutinizer analys" style="max-width:100%; height:auto; border:1px solid #ccc; padding:0.5rem;">
  <figcaption>Scrutinizer - Kodkvalitet och struktur</figcaption>
</div>

<h3>Badges</h3>
<p>
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/quality-score.png?b=main" alt="Quality">
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/coverage.png?b=main" alt="Coverage">
  <img src="https://scrutinizer-ci.com/g/mirNNes/me-report/badges/build.png?b=main" alt="Build">
</p>

<h2>FÃ¶rbÃ¤ttringar</h2>
<p>
Jag valde att gÃ¶ra fÃ¶ljande fÃ¶rbÃ¤ttringar:
</p>
<ul>
  <li>ğŸ§ª Ã–ka testtÃ¤ckning till minst 60% genom att fokusera pÃ¥ viktiga klasser och edge cases.</li>
  <li>ğŸ§¹ Refaktorera metoder med hÃ¶g komplexitet till mindre och tydligare funktioner.</li>
  <li>ğŸ› Fixa Scrutinizer-fel som oanvÃ¤nda variabler, lÃ¥ng kod, osv.</li>
  <li>ğŸ“ FÃ¶lja PSR-standarder fÃ¶r snygg och enhetlig kod.</li>
</ul>

<h2>Resultat</h2>
<table>
  <thead>
    <tr><th>MÃ¤tvÃ¤rde</th><th>FÃ¶re</th><th>Efter</th></tr>
  </thead>
  <tbody>
    <tr><td>Coverage</td><td>25%</td><td>62%</td></tr>
    <tr><td>CRAP score</td><td>31</td><td>12</td></tr>
    <tr><td>Complexity (medel)</td><td>6.5</td><td>3.4</td></tr>
  </tbody>
</table>

<h2>Diskussion</h2>
<p>
Att jobba med verktyg som Scrutinizer och Phpmetrics gÃ¶r det lÃ¤ttare att fÃ¶rstÃ¥ vad som behÃ¶ver fÃ¶rbÃ¤ttras i koden. Det Ã¤r ett effektivt sÃ¤tt att jobba mot clean code.

FÃ¶rdelarna Ã¤r att man fÃ¥r tydliga mÃ¤tvÃ¤rden att jobba mot, och att problemen blir synliga tidigt. Nackdelen Ã¤r att det ibland blir fÃ¶r mycket fokus pÃ¥ siffror istÃ¤llet fÃ¶r faktisk funktion.

Jag har lÃ¤rt mig att testbar kod oftast Ã¤r bÃ¤ttre kod. TÃ¤ckning pÃ¥ 100% betyder inte alltid kvalitet, men lÃ¥g tÃ¤ckning visar nÃ¤stan alltid pÃ¥ problem. NÃ¤sta gÃ¥ng vill jag anvÃ¤nda dessa verktyg redan frÃ¥n bÃ¶rjan â€“ det hade sparat mycket tid.

En annan insikt Ã¤r att strukturfel i bÃ¶rjan kan leda till problem senare, som Ã¤r svÃ¥ra att fixa. Det pÃ¥minner mig om poker: om du gÃ¶r ett stort misstag i bÃ¶rjan av spelet, kan du inte rÃ¤dda det i slutet hur bra du Ã¤n spelar. Detsamma gÃ¤ller kodkvalitet.
</p>

{% endblock %}
